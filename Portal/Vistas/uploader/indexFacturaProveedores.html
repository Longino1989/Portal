<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Guardar Documentos de Proveedores</title>
<script type="text/javascript" src="js/funciones.js"></script>
<script type="text/javascript" src="js/jquery-1.4.4.min.js" ></script>
<script type="text/javascript" src="js/ajaxupload.3.5.js" ></script>
<link rel="stylesheet" type="text/css" href="./styles.css" />
<script type="text/javascript" >
var arrx = location.search.substr(1).split('=')[1]
var arr=arrx.split("-");
var documento = arr[0];
var usid=arr[1];
//var tipoDoc=arr[2];
function traeDocFactura(){//alert(cod+" "+fam+" "+nom+" "+est+" "+sal+" "+ord);
     $.ajax({
    url: 'traeArchivosFacturaProv.php',
    type: 'POST',
   async: true,
   data: 'foliox='+documento+'&usidx='+usid,
   dataType: "text",
   success: function Respuesta(result){//alert(result);
   document.getElementById('files').innerHTML = result;
   /*document.getElementById('divBusqueda').style.display= "block";*/
  },
   error: Error
   });
}
/* function up2(){*/
	$(function(){//alert("ed");
		var btnUpload=$('#upload');
		var status=$('#status');
		new AjaxUpload(btnUpload, {
			action: "subirArchivosFacturaProv.php?foliox="+documento+'&usidx='+usid,
			name: 'uploadfile',
			onSubmit: function(file, ext){//alert(file+"-"+ext);
				 if (! (ext && /^(pdf)$/.test(ext))){ 
                    // extension is not allowed 
					status.text('Solo se permiten archivos PDF.');
					return false;
				}
				//if(/^(Ó|Ú)*$/.test(file)){alert("No se permiten acentos en el nombre del archivo.");return false}
				pos = file.indexOf("Ó");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("Á");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("ó");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("É");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("Í");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("Ú");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("á");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("é");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("í");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				pos = file.indexOf("ú");
				if(pos!=-1){alert("No se permiten acentos en el nombre del archivo");return false;}
				
				status.text('Uploading...');
			},
			onComplete: function(file, response){//alert(file+"-"+response);
				var arr = response.split(',,');
				var tipoExt = arr[1].split("."); //alert(tipoExt[1]);
				//On completion clear the status
				status.text('');
				//Add uploaded file to list
				//alert(arr[0]+"--"+arr[1]+"--"+tipoExt[1]);
				if(arr[0]=='success'){alert('se agrego correcto'+ext);
				
				 if(tipoExt[1]=="pdf"){alert('Entra pdf'); $('<li></li>').appendTo('#files').html('<img src="../../../archivosPDFFactura/pdf.png" alt="" /><br />'+file).addClass('success');}
				else{//alert('Entra en nada');
					$('<li></li>').appendTo('#files').html('<img src="../../../archivosPDFFactura/'+arr[1]+'" alt="" /><br />'+file).addClass('success');}
					
				} else{//alert('Entra error');
					$('<li></li>').appendTo('#files').text(file).addClass('error'); traeDocFactura(); alert('Archivo Cargado Correctamente');
				}
			}
		});
		
	});//}
function borrarImg(fol,imgid){//alert('entre'+fol+imgid);
	
   $.ajax({
   url: 'borraImagenesPro.php',
   type: 'POST',
   async: true,
   data: 'imgidx='+imgid+'&usidx='+usid,
   dataType: "text",
   success: function Respuesta(result){//alert(result);
	traeDocFactura();
   if(result==''){
	   var divCA = document.getElementById(imgid); 
	   var cont = divCA.parentNode; 
	   cont.removeChild(divCA);}
   },
   error: Error
   });
}
function actuallizaFotos(documento){//alert(documento);
window.opener.actuallizaDivFotos(documento);}

function actualizaPagPrin(){
	window.opener.location.reload();
	window.close();
}
</script>
</head>
<body onload="traeDocFactura();" onbeforeunload="actuallizaFotos(documento);">
<div id="mainbody" >
		<h3>Archivos Factura en formato .pdf del Documento <script>document.write(documento);</script> </h3>
		<!-- Upload Button, use any id you wish-->
		<div id="upload" ><span ><input type="button" value="SubirArchivo"></span></div><span id="status" ></span>
		<ul id="files" ></ul>
		<input type="button" value="Cerrar y Actualizar" onclick="actualizaPagPrin();">
</div>

</body>